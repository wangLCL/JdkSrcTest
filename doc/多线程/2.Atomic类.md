# Atomic类

变量

## AtomicInteger和AtomicLong

一个整数加减运算，如果需要保证线程安全，那么就需要加锁，synchronized关键字，但是AtomicXX性能会更好。

### 乐观锁

适用范围： 对于冲突小的场景

读的时候并不加锁，直到写入的时候才会进行判断是否更改了

Atomic就是CAS思想，

#### UInsafe的CAS函数详解

方法：一个旧值，一个更新值，写入的时候判断值是否被更新了

xxxOffset：表示在内存中的地址，c++可以操作地址的

操作的时候，先将变量的内存地址拿到，写入的时候直接操作内存地址

### 自旋和阻塞

如果没有锁，如何得到

- 放弃，进入阻塞
- 空转

单线程情况下，只能放弃，否则其他线程永远无法执行

多线程可以空转，并且还不会造成线程切换

Actomic就是使用自旋的方式，两个可以一起使用，先自旋，得不到就放弃。

### 悲观锁

使用范围： 冲突很大的情况

在读取之前先要加锁，synchronized关键字

## AtomicBoolean

int需要，但是boolean需要这种操作的原因，

```
if(flag == false){
    flag = true;
}
```